<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>¡Gracias por tu compra en Sofilu!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&family=Playfair+Display:wght@700&display=swap"
      rel="stylesheet"
    />
    <!-- Estilos Inline para Máxima Compatibilidad -->
    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #fdf7f9;
        font-family: "Manrope", sans-serif;
      }
      .wrapper {
        width: 100%;
        table-layout: fixed;
        background-color: #fdf7f9;
      }
      .main {
        max-width: 600px;
        background-color: #ffffff;
        margin: 0 auto;
        border-spacing: 0;
        font-family: "Manrope", sans-serif;
        color: #4a4a4a;
        border-radius: 24px;
        box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body>
    <center class="wrapper">
      <table class="main" width="100%">
        <!-- HEADER CON LOGO Y BANNER -->
        <tr>
          <td style="padding: 0">
            <div
              style="
                background-color: #1e1b4b;
                padding: 40px 20px;
                border-radius: 24px 24px 0 0;
                background-image: url('https://i.imgur.com/your-star-background.png');
                text-align: center;
              "
            >
              <img
                src="https://firebasestorage.googleapis.com/v0/b/sofilu-ecommerce.appspot.com/o/sofilu-logo-text.svg?alt=media&token=d16e0996-f947-4952-b137-b4d49a37e191"
                alt="Sofilu"
                width="140"
                style="display: block; margin: 0 auto"
              />
            </div>
          </td>
        </tr>

        <!-- CONTENIDO PRINCIPAL -->
        <tr>
          <td style="padding: 40px 30px">
            <!-- Mensaje de confirmación -->
            <h1
              style="
                font-family: 'Playfair Display', serif;
                font-size: 32px;
                text-align: center;
                margin: 0 0 15px;
                color: #333;
              "
            >
              ¡Tu pedido está confirmado!
            </h1>
            <p
              style="
                text-align: center;
                font-size: 16px;
                color: #666;
                margin: 0 0 30px;
                line-height: 1.6;
              "
            >
              Hola <strong><%= order.customerInfo.name %></strong>, gracias por
              tu compra. Ya estamos preparando tu paquete con mucho cariño.
            </p>

            <div style="text-align: center; margin-bottom: 30px">
              <a
                href="https://www.sofilu.shop/account/orders"
                target="_blank"
                style="
                  display: inline-block;
                  background-color: #333;
                  color: #fff;
                  padding: 14px 28px;
                  border-radius: 50px;
                  text-decoration: none;
                  font-weight: 700;
                  font-size: 15px;
                "
              >
                Ver el estado de mi pedido
              </a>
            </div>

            <hr
              style="
                border: none;
                border-top: 1px solid #f0f0f0;
                margin: 30px 0;
              "
            />

            <!-- Resumen del Pedido -->
            <h2
              style="
                font-size: 18px;
                font-weight: 800;
                color: #333;
                margin: 0 0 20px;
              "
            >
              Resumen del Pedido #<%=
              order._id.toString().slice(-6).toUpperCase() %>
            </h2>

            <% order.items.forEach(item => { %>
            <table
              width="100%"
              border="0"
              cellspacing="0"
              cellpadding="0"
              style="margin-bottom: 20px"
            >
              <tr>
                <td width="70" style="padding-right: 15px; vertical-align: top">
                  <div
                    style="
                      width: 70px;
                      height: 70px;
                      border-radius: 12px;
                      background: #f9f9f9;
                      overflow: hidden;
                    "
                  >
                    <img
                      src="<%= item.product.images[0] %>"
                      alt="<%= item.product.name %>"
                      width="70"
                      height="70"
                      style="object-fit: contain"
                    />
                  </div>
                </td>
                <td>
                  <p
                    style="
                      margin: 0;
                      font-weight: 700;
                      font-size: 15px;
                      line-height: 1.3;
                    "
                  >
                    <%= item.product.name %>
                  </p>
                  <p style="margin: 4px 0 0; font-size: 13px; color: #888">
                    Cantidad: <%= item.quantity %>
                  </p>
                </td>
                <td align="right" style="font-weight: 700; font-size: 15px">
                  $<%= (item.price * item.quantity).toLocaleString('es-CO') %>
                </td>
              </tr>
            </table>
            <% }) %>

            <hr
              style="
                border: none;
                border-top: 1px solid #f0f0f0;
                margin: 20px 0;
              "
            />

            <!-- Totales -->
            <% const subtotal = order.items.reduce((sum, item) => sum +
            (item.price * item.quantity), 0); %> <% const shipping =
            order.totalAmount - subtotal + (order.discountAmount || 0); %>
            <table
              width="100%"
              border="0"
              cellspacing="0"
              cellpadding="5"
              style="font-size: 14px"
            >
              <tr>
                <td style="color: #666">Subtotal</td>
                <td align="right">$<%= subtotal.toLocaleString('es-CO') %></td>
              </tr>
              <% if (order.discountAmount > 0) { %>
              <tr>
                <td style="color: #059669">Descuento</td>
                <td align="right" style="color: #059669">
                  - $<%= order.discountAmount.toLocaleString('es-CO') %>
                </td>
              </tr>
              <% } %>
              <tr>
                <td
                  style="
                    color: #666;
                    border-bottom: 1px solid #eee;
                    padding-bottom: 10px;
                  "
                >
                  Envío
                </td>
                <td
                  align="right"
                  style="border-bottom: 1px solid #eee; padding-bottom: 10px"
                >
                  $<%= shipping.toLocaleString('es-CO') %>
                </td>
              </tr>
              <tr style="font-size: 18px; font-weight: 800">
                <td style="padding-top: 15px">Total Pagado</td>
                <td align="right" style="padding-top: 15px">
                  $<%= order.totalAmount.toLocaleString('es-CO') %>
                </td>
              </tr>
            </table>
          </td>
        </tr>

        <!-- Footer del Email -->
        <tr>
          <td
            align="center"
            style="
              padding: 20px 40px;
              font-size: 12px;
              color: #999;
              background-color: #f9f6f3;
              border-radius: 0 0 24px 24px;
            "
          >
            <p style="margin: 0">
              Si tienes alguna pregunta, responde a este correo o contáctanos a
              través de nuestro WhatsApp.
            </p>
            <p style="margin: 10px 0 0">
              &copy; <%= new Date().getFullYear() %> Sofilu &bull; Todos los
              derechos reservados.
            </p>
          </td>
        </tr>
      </table>
    </center>
  </body>
</html>
