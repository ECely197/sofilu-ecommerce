<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>¡Gracias por tu compra en Sofilu!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&family=Playfair+Display:wght@700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #f8f4f0;
      }
      table {
        border-collapse: collapse;
      }
      p,
      h1,
      h2,
      h3,
      h4,
      span,
      td {
        font-family: "Manrope", Arial, sans-serif;
        color: #4a4a4a;
      }
    </style>
  </head>
  <body style="margin: 0; padding: 0; background-color: #f8f4f0">
    <table
      width="100%"
      border="0"
      cellspacing="0"
      cellpadding="0"
      style="background: linear-gradient(180deg, #fff0f5 0%, #f3e5f5 100%)"
    >
      <tr>
        <td align="center" style="padding: 40px 20px">
          <!-- Tarjeta Principal (Glass Effect) -->
          <table
            width="600"
            border="0"
            cellspacing="0"
            cellpadding="0"
            style="
              max-width: 600px;
              background-color: rgba(255, 255, 255, 0.85);
              border-radius: 24px;
              border: 1px solid rgba(255, 255, 255, 0.6);
            "
          >
            <!-- Header con Logo -->
            <tr>
              <td align="center" style="padding: 30px 0">
                <img
                  src="https://www.sofilu.shop/sofilu-logo.svg"
                  alt="Sofilu"
                  width="120"
                  style="display: block"
                />
              </td>
            </tr>

            <!-- Contenido Principal -->
            <tr>
              <td style="padding: 0 40px 40px">
                <!-- Mensaje de Bienvenida -->
                <h1
                  style="
                    font-family: 'Playfair Display', serif;
                    font-size: 28px;
                    text-align: center;
                    margin: 0 0 10px;
                    color: #333;
                  "
                >
                  ¡Pedido Confirmado!
                </h1>
                <p
                  style="
                    text-align: center;
                    font-size: 16px;
                    color: #666;
                    margin: 0 0 30px;
                    line-height: 1.5;
                  "
                >
                  Hola <%= order.customerInfo.name %>, ¡tu compra ha sido un
                  éxito! Ya estamos preparando tu dosis de confort.
                </p>

                <div
                  style="
                    background: #fff8f9;
                    padding: 12px 20px;
                    border-radius: 12px;
                    text-align: center;
                    margin-bottom: 30px;
                  "
                >
                  <p style="margin: 0; font-size: 14px">
                    N° de Pedido:
                    <strong style="color: #d63384"
                      >#<%= order._id.toString().slice(-6).toUpperCase()
                      %></strong
                    >
                  </p>
                </div>

                <!-- Productos -->
                <% order.items.forEach(item => { %>
                <table
                  width="100%"
                  border="0"
                  cellspacing="0"
                  cellpadding="0"
                  style="margin-bottom: 20px"
                >
                  <tr>
                    <td width="70" style="padding-right: 15px">
                      <img
                        src="<%= item.product.images[0] %>"
                        alt="<%= item.product.name %>"
                        width="70"
                        height="70"
                        style="
                          border-radius: 12px;
                          object-fit: cover;
                          background: #fff;
                        "
                      />
                    </td>
                    <td>
                      <p style="margin: 0; font-weight: 700; font-size: 15px">
                        <%= item.product.name %>
                      </p>
                      <p style="margin: 4px 0 0; font-size: 13px; color: #888">
                        Cantidad: <%= item.quantity %>
                      </p>
                    </td>
                    <td align="right" style="font-weight: 700">
                      $<%= (item.price * item.quantity).toLocaleString('es-CO')
                      %>
                    </td>
                  </tr>
                </table>
                <% }) %>

                <hr
                  style="
                    border: none;
                    border-top: 1px dashed #ddd;
                    margin: 30px 0;
                  "
                />

                <!-- Totales -->
                <%# Cálculo de costos %> <% const subtotal =
                order.items.reduce((sum, item) => sum + (item.price *
                item.quantity), 0); %> <% const shipping = order.totalAmount -
                subtotal + (order.discountAmount || 0); %>

                <table width="100%" border="0" cellspacing="0" cellpadding="5">
                  <tr>
                    <td>Subtotal</td>
                    <td align="right">
                      $<%= subtotal.toLocaleString('es-CO') %>
                    </td>
                  </tr>
                  <% if (order.discountAmount > 0) { %>
                  <tr>
                    <td style="color: #059669">Descuento</td>
                    <td align="right" style="color: #059669">
                      - $<%= order.discountAmount.toLocaleString('es-CO') %>
                    </td>
                  </tr>
                  <% } %>
                  <tr>
                    <td>Envío</td>
                    <td align="right">
                      $<%= shipping.toLocaleString('es-CO') %>
                    </td>
                  </tr>
                  <tr style="font-size: 18px; font-weight: 800">
                    <td style="padding-top: 15px; border-top: 2px solid #eee">
                      Total
                    </td>
                    <td
                      align="right"
                      style="padding-top: 15px; border-top: 2px solid #eee"
                    >
                      $<%= order.totalAmount.toLocaleString('es-CO') %>
                    </td>
                  </tr>
                </table>

                <hr
                  style="
                    border: none;
                    border-top: 1px dashed #ddd;
                    margin: 30px 0;
                  "
                />

                <!-- Botón de Acción -->
                <table width="100%" border="0" cellspacing="0" cellpadding="0">
                  <tr>
                    <td align="center">
                      <a
                        href="https://www.sofilu.shop/account/orders"
                        target="_blank"
                        style="
                          display: inline-block;
                          background-color: #333;
                          color: #fff;
                          padding: 14px 28px;
                          border-radius: 50px;
                          text-decoration: none;
                          font-weight: 700;
                          font-size: 15px;
                        "
                      >
                        Ver mi Pedido
                      </a>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>

            <!-- Footer del Email -->
            <tr>
              <td
                align="center"
                style="
                  padding: 20px;
                  font-size: 12px;
                  color: #999;
                  border-top: 1px solid #eee;
                "
              >
                <p style="margin: 0">
                  Si tienes alguna pregunta, responde a este correo.
                </p>
                <p style="margin: 5px 0 0">
                  &copy; <%= new Date().getFullYear() %> Sofilu. Todos los
                  derechos reservados.
                </p>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
  </body>
</html>
