<header class="sofilu-header">
  <div class="header-pill left">
    <nav #navContainer class="desktop-nav">
      <div #navPill class="nav-pill"></div>

      <a
        #navLink
        class="nav-link"
        routerLink="/"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
      >
        <span class="nav-link-text-wrapper">
          <span class="nav-link-text-inner">
            <span class="nav-link-text">Inicio</span>
            <span class="nav-link-text">Inicio</span>
          </span>
        </span>
      </a>
      <a
        #navLink
        class="nav-link"
        routerLink="/category/sabanas"
        routerLinkActive="active"
      >
        <span class="nav-link-text-wrapper">
          <span class="nav-link-text-inner">
            <span class="nav-link-text">Sábanas</span>
            <span class="nav-link-text">Sábanas</span>
          </span>
        </span>
      </a>
      <a
        #navLink
        class="nav-link"
        routerLink="/category/pijamas"
        routerLinkActive="active"
      >
        <span class="nav-link-text-wrapper">
          <span class="nav-link-text-inner">
            <span class="nav-link-text">Pijamas</span>
            <span class="nav-link-text">Pijamas</span>
          </span>
        </span>
      </a>
      <a
        #navLink
        class="nav-link"
        routerLink="/category/toallas"
        routerLinkActive="active"
      >
        <span class="nav-link-text-wrapper">
          <span class="nav-link-text-inner">
            <span class="nav-link-text">Toallas</span>
            <span class="nav-link-text">Toallas</span>
          </span>
        </span>
      </a>
      <a
        #navLink
        class="nav-link"
        routerLink="/category/batas"
        routerLinkActive="active"
      >
        <span class="nav-link-text-wrapper">
          <span class="nav-link-text-inner">
            <span class="nav-link-text">Batas</span>
            <span class="nav-link-text">Batas</span>
          </span>
        </span>
      </a>
    </nav>
  </div>

  <div class="logo-wrapper">
    <a routerLink="/" class="logo-link" (click)="closeAllMenus()">
      <img
        src="/sofilu-logo-text.svg"
        alt="Logo de Sofilu"
        class="logo-image"
      />
    </a>
  </div>

  <div class="header-pill right">
    <div class="header-right">
      <form class="search-form" (submit)="handleSearch($event, searchInput)">
        <input
          #searchInput
          type="text"
          placeholder="Buscar..."
          class="search-input"
        />
        <button type="submit" class="search-button">
          <span class="material-symbols-outlined">search</span>
        </button>
      </form>
      <a
        routerLink="/wishlist"
        class="icon-button"
        aria-label="Lista de deseos"
      >
        <span class="material-symbols-outlined">favorite_border</span>
      </a>
      <button
        (click)="uiStateService.openCartFlyout()"
        class="icon-button"
        aria-label="Abrir carrito"
      >
        <span class="material-symbols-outlined">shopping_bag</span>
        @if (cartService.totalItems() > 0) {
        <span class="cart-badge">{{ cartService.totalItems() }}</span>
        }
      </button>
      @if (currentUser$ | async; as user) {
      <div class="profile-container">
        <button
          (click)="toggleProfileMenu($event)"
          class="profile-button"
          aria-label="Abrir menú de perfil"
        >
          @if(user.email) {
          <span>{{ user.email.charAt(0).toUpperCase() }}</span>
          }
        </button>
        @if (isProfileMenuOpen()) {
        <div class="profile-menu" @flyInOut>
          <div class="menu-header">
            @if(user.email) {
            <p class="user-email">{{ user.email }}</p>
            }
          </div>
          <div class="menu-links">
            <a routerLink="/account" (click)="toggleProfileMenu()">Mi Cuenta</a>
            @if(isAdmin$ | async) {
            <a routerLink="/admin" (click)="toggleProfileMenu()"
              >Panel de Admin</a
            >
            }
          </div>
          <div class="menu-footer">
            <button (click)="logout()" class="logout-button">
              Cerrar Sesión
            </button>
          </div>
        </div>
        }
      </div>
      } @else {
      <a routerLink="/login" class="login-button">Iniciar Sesión</a>
      }
    </div>
  </div>

  <!-- Controles para Móvil -->
  <button
    class="hamburger-button"
    (click)="toggleMobileMenu()"
    aria-label="Abrir menú de navegación"
  >
    <span class="material-symbols-outlined">{{
      isMobileMenuOpen() ? "close" : "menu"
    }}</span>
  </button>

  <nav class="mobile-nav" [class.is-open]="isMobileMenuOpen()">
    <a
      class="mobile-nav-link"
      routerLink="/category/sabanas"
      (click)="toggleMobileMenu()"
      >Sábanas</a
    >
    <a
      class="mobile-nav-link"
      routerLink="/category/pijamas"
      (click)="toggleMobileMenu()"
      >Pijamas</a
    >
    <a
      class="mobile-nav-link"
      routerLink="/category/toallas"
      (click)="toggleMobileMenu()"
      >Toallas</a
    >
    <a
      class="mobile-nav-link"
      routerLink="/category/batas"
      (click)="toggleMobileMenu()"
      >Batas</a
    >
  </nav>
  <div
    class="mobile-overlay"
    [class.is-open]="isMobileMenuOpen()"
    (click)="toggleMobileMenu()"
  ></div>
</header>
