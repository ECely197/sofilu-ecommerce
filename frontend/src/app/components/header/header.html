<header class="sofilu-header">
  <div class="header-pill">
    <nav #navContainer class="desktop-nav">
      <div #navPill class="nav-pill"></div>

      <a
        #navLink
        routerLink="/"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        class="nav-link"
      >
        <span class="nav-text-original">Inicio</span>
        <span class="nav-text-reveal">Inicio</span>
      </a>
      <a
        #navLink
        routerLink="/category/sabanas"
        routerLinkActive="active"
        class="nav-link"
      >
        <span class="nav-text-original">Sábanas</span>
        <span class="nav-text-reveal">Sábanas</span>
      </a>
      <a
        #navLink
        routerLink="/category/pijamas"
        routerLinkActive="active"
        class="nav-link"
      >
        <span class="nav-text-original">Pijamas</span>
        <span class="nav-text-reveal">Pijamas</span>
      </a>
      <a
        #navLink
        routerLink="/category/toallas"
        routerLinkActive="active"
        class="nav-link"
      >
        <span class="nav-text-original">Toallas</span>
        <span class="nav-text-reveal">Toallas</span>
      </a>
      <a
        #navLink
        routerLink="/category/batas"
        routerLinkActive="active"
        class="nav-link"
      >
        <span class="nav-text-original">Batas</span>
        <span class="nav-text-reveal">Batas</span>
      </a>
    </nav>

    <!-- LOGO (CENTRO) -->
    <div class="logo-wrapper">
      <a routerLink="/" class="logo-link">
        <img
          src="/sofilu-logo-text.svg"
          alt="Logo de Sofilu"
          class="logo-image"
        />
      </a>
    </div>

    <!-- ACCIONES (DERECHA) -->
    <div class="header-right">
      <form class="search-form" (submit)="handleSearch($event, searchInput)">
        <span class="material-symbols-outlined search-icon">search</span>
        <input
          #searchInput
          type="text"
          placeholder="Buscar..."
          class="search-input"
        />
      </form>

      <a
        routerLink="/wishlist"
        class="icon-button"
        aria-label="Lista de deseos"
      >
        <span class="material-symbols-outlined">favorite_border</span>
      </a>

      <button
        (click)="uiStateService.openCartFlyout()"
        class="icon-button"
        aria-label="Abrir carrito"
      >
        <span class="material-symbols-outlined">shopping_bag</span>
        @if (cartService.totalItems() > 0) {
        <span class="cart-badge">{{ cartService.totalItems() }}</span>
        }
      </button>

      @if (currentUser$ | async; as user) {
      <div class="profile-container">
        <button (click)="toggleProfileMenu($event)" class="profile-button">
          <span>{{ user.email?.charAt(0)?.toUpperCase() }}</span>
        </button>
        @if (isProfileMenuOpen()) {
        <div #profileMenu class="profile-menu">
          <!-- Quitamos la animación @flyInOut de aquí -->
          <div class="menu-header">
            @if(user.email) {
            <p class="user-email">{{ user.email }}</p>
            }
          </div>
          <div class="menu-links">
            <a routerLink="/account" (click)="toggleProfileMenu()">Mi Cuenta</a>
            @if(isAdmin$ | async) {
            <a routerLink="/admin" (click)="toggleProfileMenu()"
              >Panel de Admin</a
            >
            }
          </div>
          <div class="menu-footer">
            <button (click)="logout()" class="logout-button">
              Cerrar Sesión
            </button>
          </div>
        </div>
        }
      </div>
      } @else {
      <a routerLink="/login" class="login-button btn btn-primary"
        >Iniciar Sesión</a
      >
      }
    </div>
  </div>
</header>
