<header (mouseleave)="handleMouseLeave()" class="sofilu-header">
  <div class="header-pill">
    <!-- LOGO (IZQUIERDA) -->
    <div class="logo-wrapper">
      <a routerLink="/" class="logo-link">
        <img
          src="/sofilu-logo-text.svg"
          alt="Logo de Sofilu"
          class="logo-image"
        />
      </a>
    </div>

    <!-- NAVEGACIÓN (CENTRO) -->
    <nav #navContainer class="desktop-nav">
      <div #navPill class="nav-pill"></div>

      @for (item of navItems(); track item.id) {
      <div
        (mouseenter)="handleMouseEnter(item)"
        (mouseleave)="handleMouseLeave()"
        class="nav-item-wrapper"
      >
        <a
          [routerLink]="item.slug"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{ exact: item.slug === '/' }"
          class="nav-link"
        >
          <span class="nav-text-original">{{ item.name }}</span>
          <span class="nav-text-reveal">{{ item.name }}</span>
        </a>
      </div>
      }
    </nav>

    <!-- ACCIONES (DERECHA) -->
    <div class="header-right">
      <!-- ... (El código de la búsqueda, wishlist, carrito y perfil no cambia) ... -->
    </div>
  </div>

  <!-- ¡MEGA MENÚ FLOTANTE! (La lógica interna no cambia) -->
  <div
    class="mega-menu-container"
    [class.is-active]="activeMenu()"
    (mouseenter)="handleMouseEnter(activeMenu()!)"
    (mouseleave)="handleMouseLeave()"
  >
    @if (activeMenu(); as menu) {
    <div class="mega-menu-card">
      <!-- Columna Izquierda: Subcategorías -->
      <div class="sub-category-list">
        @for (sub of menu.subCategories; track sub.id) {
        <a
          [routerLink]="['/category', sub.id.split('-')[0]]"
          (mouseenter)="handleSubCategoryEnter(sub)"
          [class.active]="activeSubCategory()?.id === sub.id"
          class="sub-category-link"
        >
          {{ sub.name }}
        </a>
        }
      </div>
      <!-- Columna Derecha: Previsualización de Productos -->
      <div class="product-preview-grid">
        @if (activeSubCategory(); as subCat) { @for (product of subCat.products;
        track product._id) {
        <a
          [routerLink]="['/product', product._id]"
          class="preview-product-card"
        >
          @if(product.images.length > 0) {
          <img [src]="product.images[0]" [alt]="product.name" />
          } @else {
          <div class="image-placeholder"></div>
          }
          <p>{{ product.name }}</p>
        </a>
        } }
      </div>
    </div>
    }
  </div>
</header>
