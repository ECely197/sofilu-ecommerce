<!-- Contenido completo para: src/app/components/cart-flyout/cart-flyout.html -->

<div class="flyout-container" [class.is-open]="uiState.isCartFlyoutVisible()">
  <div class="flyout-overlay" (click)="closeCart()"></div>

  <aside class="flyout-panel">
    <header class="flyout-header">
      <div class="header-title-pill">
        <span>Tu Carrito</span>
        <button class="close-button" (click)="closeCart()" appRipple>
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
    </header>

    @if (cartService.totalItems() > 0) {
    <div class="items-list">
      @for (item of cartService.cartItems(); track item.id) {
      <div class="cart-item">
        <img
          [src]="item.product.images[0]"
          [alt]="item.product.name"
          class="item-image"
        />
        <div class="item-info">
          <p class="item-name">{{ item.product.name }}</p>
          <div class="item-variants">
            @for (key of objectKeys(item.selectedVariants); track key) {
            <span
              >{{ key }}:
              <strong>{{ item.selectedVariants[key] }}</strong></span
            >
            }
          </div>
        </div>
        <div class="item-actions">
          <button
            (click)="cartService.updateQuantity(item.id, item.quantity - 1)"
            class="quantity-btn"
            appRipple
          >
            -
          </button>
          <span class="quantity-value">{{ item.quantity }}</span>
          <button
            (click)="cartService.updateQuantity(item.id, item.quantity + 1)"
            class="quantity-btn"
            appRipple
          >
            +
          </button>
        </div>
      </div>
      }
    </div>

    <footer class="flyout-footer">
      <div class="subtotal-row">
        <span>Subtotal</span>
        <span>{{
          cartService.subTotal() | currency : "COP" : "symbol" : "1.0-0"
        }}</span>
      </div>
      <a routerLink="/cart" class="btn-material" (click)="closeCart()" appRipple
        >Ver Carrito y Pagar</a
      >
    </footer>

    } @else {
    <!-- ¡NUEVO! El estado del carrito vacío con TU Gato Interactivo -->
    <div class="empty-state" (click)="requestOrientationPermission()">
      <div class="cat-container">
        <!-- TU SVG - MODIFICADO CON IDs Y UN GRUPO <g> PARA LAS PUPILAS -->
        <svg
          xmlns="http://www.w3.org/2000/svg"
          version="1.1"
          viewBox="0.00 0.00 500.00 500.00"
        >
          <!-- Cuerpo del gato (sin cambios) -->
          <path
            fill="#20221f"
            d=" M 175.32 413.29 Q 168.13 421.34 158.08 419.50 C 153.88 418.73 150.45 416.38 147.90 413.07 A 0.68 0.67 -42.7 0 0 146.87 413.03 L 145.36 414.66 A 1.38 1.30 8.8 0 1 144.91 414.97 Q 139.11 417.23 133.35 414.81 Q 130.74 413.71 128.10 410.67 C 123.78 405.68 123.02 397.88 124.41 391.77 Q 126.79 381.39 135.72 374.00 A 0.81 0.80 -33.8 0 0 135.92 373.00 Q 133.42 368.26 132.24 365.53 Q 129.79 359.81 128.22 355.13 A 4.72 4.43 -59.9 0 1 128.00 354.18 Q 127.63 351.59 126.52 348.49 A 6.00 5.92 -58.6 0 1 126.20 347.13 Q 125.39 340.23 124.52 333.25 Q 124.02 329.31 124.56 324.02 Q 125.08 318.92 126.11 309.78 A 8.30 8.20 -33.3 0 1 126.44 308.23 Q 126.86 306.88 127.35 305.40 C 127.93 303.63 127.81 301.43 128.69 299.73 C 129.81 297.58 129.96 294.59 131.44 292.24 A 1.91 1.88 59.7 0 0 131.73 291.10 Q 131.58 289.12 130.48 286.20 A 6.24 6.21 -58.2 0 1 130.11 284.61 Q 129.60 279.65 128.40 275.55 A 5.56 5.42 -55.6 0 1 128.22 274.51 Q 127.87 269.25 127.23 264.98 C 125.38 252.77 125.53 239.70 126.09 227.87 C 126.32 222.96 127.58 218.40 128.14 213.43 A 4.32 4.14 -31.3 0 1 128.46 212.23 Q 129.00 210.98 129.77 208.01 Q 130.64 204.66 132.91 200.66 Q 135.02 196.95 138.73 194.84 A 3.76 3.54 -65.2 0 1 139.50 194.53 Q 144.75 193.19 150.66 194.36 Q 152.41 194.71 155.27 196.12 Q 158.47 197.69 159.78 198.46 Q 169.98 204.46 183.54 216.22 Q 192.16 223.69 206.22 238.41 A 0.80 0.78 56.7 0 0 207.10 238.60 L 209.17 237.73 A 2.38 2.24 28.2 0 1 209.69 237.59 Q 213.80 237.04 216.83 235.85 A 1.17 0.97 23.7 0 1 217.04 235.79 L 228.88 233.73 A 0.35 0.31 -48.6 0 1 228.96 233.72 Q 240.99 233.04 242.74 232.92 Q 251.57 232.30 256.29 232.62 Q 259.78 232.86 272.99 233.56 Q 276.05 233.72 279.84 234.56 Q 283.25 235.33 287.05 235.62 A 3.46 2.95 49.5 0 1 287.55 235.70 L 299.20 238.67 A 0.27 0.27 0.0 0 0 299.52 238.51 Q 299.64 238.20 307.51 230.27 Q 323.05 214.59 339.36 202.87 Q 342.41 200.68 346.23 198.47 Q 350.21 196.17 351.83 195.79 A 1.30 1.30 0.0 0 0 352.43 195.49 C 353.80 194.29 356.21 194.33 357.96 194.01 Q 362.47 193.17 366.77 194.77 Q 368.72 195.50 371.31 198.47 Q 372.49 199.83 374.14 203.53 Q 375.63 206.87 376.05 209.03 C 376.68 212.30 377.57 213.91 377.87 217.28 C 378.24 221.51 379.51 228.92 379.56 234.65 Q 379.68 249.25 379.38 251.88 Q 378.06 263.72 377.79 268.45 Q 377.60 271.77 376.64 275.83 Q 376.07 278.29 375.63 283.20 A 3.14 2.94 60.3 0 1 375.42 284.08 Q 373.78 288.15 374.04 291.71 A 3.91 3.91 0.0 0 0 374.26 292.74 Q 377.55 302.05 377.74 303.55 Q 378.15 306.64 379.35 310.40 A 6.60 6.42 35.2 0 1 379.64 311.95 Q 380.00 318.21 380.56 322.09 Q 380.97 324.92 380.88 327.41 C 380.78 330.00 381.08 332.36 380.68 334.52 Q 380.24 336.88 379.59 345.16 A 4.32 4.24 -33.8 0 1 379.35 346.31 Q 378.39 348.99 378.16 350.42 Q 377.75 352.97 377.22 354.54 Q 374.02 363.95 371.90 367.98 Q 370.09 371.40 369.37 373.14 A 0.78 0.78 0.0 0 0 369.59 374.04 Q 379.83 382.57 381.47 395.25 C 382.17 400.68 380.62 407.61 376.68 411.52 Q 370.20 417.93 360.33 415.00 Q 359.17 414.65 358.13 413.55 Q 357.19 412.56 356.94 412.89 C 356.56 413.40 356.43 413.99 355.85 414.53 Q 350.19 419.92 343.03 419.84 Q 335.35 419.74 329.91 413.57 A 0.65 0.65 0.0 0 0 329.07 413.45 Q 322.59 417.72 315.12 415.11 C 310.36 413.45 306.93 408.87 305.52 404.20 A 0.81 0.80 -8.2 0 0 304.75 403.63 L 200.99 403.63 A 0.98 0.97 -77.8 0 0 200.10 404.21 C 199.35 405.84 198.51 408.14 197.28 409.72 Q 190.14 418.92 178.44 414.88 Q 177.60 414.60 176.13 413.25 A 0.57 0.57 0.0 0 0 175.32 413.29 Z M 141.83 370.03 Q 142.88 369.50 143.69 368.90 C 144.89 368.00 146.24 368.25 147.35 367.34 C 148.82 366.13 152.13 365.83 153.67 365.25 Q 155.15 364.68 158.42 364.33 Q 169.26 363.19 178.58 367.12 Q 193.25 373.31 199.15 387.79 C 200.46 391.01 200.46 393.50 200.67 397.02 A 0.81 0.81 0.0 0 0 201.48 397.79 L 304.19 397.79 A 0.46 0.46 0.0 0 0 304.65 397.34 Q 304.79 387.95 310.35 379.98 A 1.21 1.18 0.8 0 1 310.70 379.65 Q 311.35 379.26 311.53 378.53 A 1.78 1.72 74.5 0 1 311.92 377.81 Q 326.78 361.48 348.38 364.43 Q 354.91 365.33 363.67 369.91 A 0.51 0.51 0.0 0 0 364.40 369.57 Q 364.63 368.58 365.47 367.76 A 2.07 2.06 74.8 0 0 366.01 366.81 C 366.44 365.04 367.31 364.10 367.80 362.86 Q 369.60 358.28 371.20 353.47 C 372.16 350.57 372.42 347.44 373.44 344.86 A 3.63 3.59 -31.7 0 0 373.67 343.91 C 374.29 336.92 375.10 330.12 374.52 323.12 C 373.99 316.67 373.95 313.29 372.67 309.43 A 5.55 5.21 -59.9 0 1 372.43 308.40 Q 371.73 303.20 370.49 300.83 Q 370.13 300.16 370.00 298.61 A 3.13 3.11 29.1 0 0 369.65 297.40 C 366.73 291.95 368.14 287.26 369.71 281.62 A 5.56 5.43 -35.6 0 0 369.92 280.44 Q 370.21 276.66 371.01 272.97 Q 371.71 269.78 372.02 265.48 Q 372.49 258.86 372.96 252.25 Q 374.18 234.99 371.98 218.67 C 371.55 215.43 370.60 212.65 369.83 209.41 Q 368.86 205.41 365.97 201.81 C 363.62 198.88 357.24 199.87 354.44 201.17 Q 349.75 203.34 348.28 204.28 Q 338.71 210.44 330.09 217.58 Q 317.40 228.10 306.62 239.85 A 4.24 3.49 -12.9 0 0 306.18 240.42 Q 304.44 243.07 302.12 244.80 A 1.98 1.92 -64.2 0 1 301.05 245.19 Q 297.92 245.37 294.91 243.89 A 4.02 3.99 -27.6 0 0 293.62 243.49 Q 289.54 242.94 286.12 241.73 A 4.06 3.90 55.6 0 0 285.16 241.53 Q 281.35 241.22 277.05 240.36 Q 272.92 239.54 268.90 239.32 Q 252.76 238.43 235.70 239.34 Q 231.80 239.55 227.89 240.37 Q 224.03 241.18 219.99 241.57 A 0.40 0.34 -49.7 0 0 219.87 241.59 L 211.48 243.65 A 1.18 0.92 18.6 0 0 211.22 243.74 Q 207.89 245.48 204.54 245.14 A 1.88 1.88 0.0 0 1 203.59 244.75 C 201.38 243.02 199.74 240.55 197.76 238.43 Q 186.17 225.95 173.33 215.72 Q 161.48 206.29 157.93 204.57 Q 155.47 203.39 155.05 202.87 A 1.52 1.47 -10.8 0 0 154.24 202.34 Q 152.18 201.81 150.85 200.85 A 2.14 2.07 67.8 0 0 149.99 200.47 Q 146.59 199.84 144.32 199.88 C 140.06 199.94 138.63 202.82 136.89 206.29 C 135.60 208.87 135.30 211.71 134.28 214.16 A 3.60 3.53 60.4 0 0 134.02 215.14 C 133.37 220.62 132.15 225.39 132.06 230.67 Q 131.72 250.63 132.33 255.76 Q 133.51 265.81 133.88 270.58 Q 134.09 273.25 134.98 276.82 Q 135.39 278.45 135.99 283.13 A 8.06 7.75 32.6 0 0 136.41 284.87 C 137.62 288.22 138.54 291.26 136.71 295.14 Q 136.26 296.10 135.01 300.02 Q 133.90 303.50 133.65 304.94 Q 133.16 307.79 132.21 310.52 A 3.62 3.58 56.8 0 0 132.01 311.51 Q 131.81 314.74 131.35 318.16 Q 130.77 322.45 130.73 324.82 Q 130.50 336.55 132.18 345.50 Q 134.50 357.92 141.05 369.79 A 0.59 0.58 61.6 0 0 141.83 370.03 Z M 147.05 393.88 Q 149.82 393.28 150.42 395.94 A 2.06 1.87 42.3 0 1 150.47 396.46 C 150.26 403.54 149.86 408.03 155.81 412.29 A 3.26 3.18 -17.9 0 0 156.80 412.78 Q 168.27 416.26 172.58 405.22 A 1.35 1.28 -36.4 0 0 172.66 404.77 L 172.54 396.45 A 1.86 1.80 59.8 0 1 172.77 395.52 Q 173.90 393.44 175.63 393.87 A 3.80 3.58 -86.3 0 1 178.36 397.17 Q 178.36 397.27 178.42 403.81 C 178.44 406.44 178.15 408.07 180.98 409.30 Q 185.15 411.11 189.20 408.98 Q 192.64 407.17 194.24 402.00 Q 195.02 399.51 194.51 394.54 Q 194.14 390.97 192.33 387.43 Q 187.92 378.84 179.24 374.24 Q 168.53 368.57 157.75 370.60 Q 147.95 372.43 140.42 378.20 Q 132.33 384.39 130.19 393.25 Q 129.54 395.95 130.18 402.10 A 1.13 1.05 -63.4 0 0 130.30 402.51 L 132.21 406.35 A 1.84 1.68 -83.1 0 0 132.54 406.81 Q 134.78 409.15 138.05 409.91 Q 140.84 410.57 143.08 408.61 A 1.48 1.43 -14.3 0 0 143.51 407.91 Q 144.70 403.40 144.55 400.39 A 0.83 0.71 54.3 0 1 144.57 400.14 L 145.78 395.12 A 1.66 1.65 0.5 0 1 147.05 393.88 Z M 339.49 413.15 Q 348.88 415.07 353.07 407.93 C 355.01 404.60 354.57 400.97 354.39 397.51 Q 354.27 395.25 355.22 394.35 A 2.28 2.05 -36.5 0 1 358.66 394.68 C 360.68 398.51 360.24 402.77 360.43 406.28 C 360.58 409.10 363.18 409.75 365.67 409.81 C 373.98 410.01 376.81 401.08 375.33 394.39 Q 373.67 386.91 369.29 382.18 Q 368.34 381.15 366.81 379.66 C 364.71 377.61 363.03 376.73 359.60 374.48 A 2.67 2.56 -19.7 0 0 358.84 374.14 Q 357.12 373.66 355.82 372.65 A 0.36 0.18 0.0 0 0 355.72 372.60 L 348.06 370.33 A 2.70 2.56 51.8 0 0 347.31 370.22 L 337.18 370.22 A 4.32 4.17 -52.4 0 0 335.96 370.40 Q 331.17 371.83 328.98 372.76 Q 321.46 375.95 316.31 382.24 Q 310.94 388.79 310.62 397.25 Q 310.46 401.73 312.31 404.96 Q 314.82 409.34 320.02 410.09 Q 323.77 410.63 326.53 407.04 A 1.42 1.38 -27.0 0 0 326.82 406.19 L 326.89 396.46 A 2.60 2.60 0.0 0 1 329.60 393.88 L 329.83 393.89 A 3.05 3.04 -88.6 0 1 332.70 396.91 C 332.83 399.39 332.13 401.86 332.54 404.73 Q 333.36 410.40 338.81 412.92 A 2.96 2.66 60.6 0 0 339.49 413.15 Z"
          />

          <!-- Grupo <g> que envolverá las pupilas para moverlas juntas -->
          <g [style.transform]="pupilTransform()">
            <!-- Pupila Izquierda -->
            <path
              fill="#20221f"
              d=" M 188.62 303.11 A 2.79 2.72 72.3 0 1 189.05 302.25 Q 194.28 295.50 202.18 294.44 Q 206.55 293.86 211.64 296.51 C 219.94 300.84 223.54 310.44 219.85 319.14 C 217.48 324.77 211.60 329.48 205.19 329.45 C 201.48 329.43 198.99 329.60 195.78 327.77 Q 184.16 321.17 186.89 307.00 A 3.90 3.77 -26.5 0 1 187.30 305.85 Q 188.44 303.75 188.62 303.11 Z M 214.06 311.06 A 3.88 3.88 0.0 0 0 210.18 307.18 A 3.88 3.88 0.0 0 0 206.30 311.06 A 3.88 3.88 0.0 0 0 210.18 314.94 A 3.88 3.88 0.0 0 0 214.06 311.06 Z"
            />
            <!-- Pupila Derecha -->
            <path
              fill="#20221f"
              d=" M 286.25 302.21 Q 291.49 295.44 299.41 294.38 Q 303.79 293.80 308.89 296.45 C 317.21 300.79 320.81 310.41 317.12 319.13 C 314.74 324.77 308.85 329.49 302.43 329.46 C 298.71 329.44 296.21 329.61 293.00 327.78 Q 281.35 321.16 284.09 306.97 A 3.91 3.78 -26.5 0 1 284.50 305.81 Q 285.64 303.71 285.82 303.07 A 2.80 2.72 72.3 0 1 286.25 302.21 Z M 311.57 310.97 A 3.85 3.85 0.0 0 0 307.72 307.12 A 3.85 3.85 0.0 0 0 303.87 310.97 A 3.85 3.85 0.0 0 0 307.72 314.82 A 3.85 3.85 0.0 0 0 311.57 310.97 Z"
            />
          </g>

          <!-- Nariz y boca (sin cambios) -->
          <path
            fill="#20221f"
            d=" M 252.91 353.75 A 0.53 0.53 0.0 0 0 252.01 353.77 Q 247.49 361.21 238.79 363.48 Q 234.41 364.62 231.54 363.65 Q 230.89 363.44 228.34 362.58 Q 225.60 361.66 223.21 359.63 Q 219.67 356.63 217.68 351.29 Q 217.40 350.54 217.44 347.44 A 1.41 1.37 67.1 0 1 217.79 346.54 Q 219.33 344.84 220.41 345.13 A 4.07 3.35 8.5 0 1 223.38 348.42 Q 223.48 351.50 227.55 355.42 A 4.08 4.01 -10.7 0 0 228.79 356.25 Q 238.99 360.68 245.99 351.76 Q 248.44 348.63 249.04 343.78 A 0.88 0.88 0.0 0 0 248.58 342.90 C 247.97 342.59 246.76 342.70 245.72 342.10 Q 240.98 339.39 239.67 335.46 Q 238.25 331.24 240.96 328.92 Q 242.73 327.40 247.85 327.39 Q 258.01 327.36 260.24 327.53 C 262.89 327.74 266.91 329.99 266.20 333.19 Q 265.10 338.19 261.24 340.92 Q 258.98 342.52 256.66 342.71 A 1.00 0.99 84.7 0 0 255.75 343.81 Q 256.42 349.82 260.66 353.61 C 265.97 358.35 273.41 358.96 278.91 354.18 Q 281.42 351.99 282.38 347.54 A 1.54 1.50 77.9 0 1 282.92 346.68 Q 285.48 344.69 287.51 346.81 Q 288.83 348.19 288.10 350.33 Q 284.34 361.46 272.95 363.67 Q 270.28 364.19 267.35 363.58 Q 258.18 361.69 252.91 353.75 Z"
          />
        </svg>
      </div>
      <p>Tu carrito está soñando...</p>
      <p class="subtitle">Añade algo para despertarlo.</p>
    </div>
    }
  </aside>
</div>
