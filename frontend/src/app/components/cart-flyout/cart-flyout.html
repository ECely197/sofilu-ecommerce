<!-- Contenido completo para: src/app/components/cart-flyout/cart-flyout.html -->

<div class="flyout-container" [class.is-open]="uiState.isCartFlyoutVisible()">
  <div class="flyout-overlay" (click)="closeCart()"></div>

  <aside class="flyout-panel">
    <header class="flyout-header">
      <h2 class="flyout-title">Tu Carrito</h2>
      <button class="close-button" (click)="closeCart()">
        <span class="material-symbols-outlined">close</span>
      </button>
    </header>

    @if (cartService.totalItems() > 0) {
    <div class="items-list">
      @for (item of cartService.cartItems(); track item.id) {
      <div class="cart-item">
        <img
          [src]="item.product.images[0]"
          [alt]="item.product.name"
          class="item-image"
        />
        <div class="item-info">
          <p class="item-name">{{ item.product.name }}</p>
          <div class="item-variants">
            @for (key of objectKeys(item.selectedVariants); track key) {
            <span
              >{{ key }}:
              <strong>{{ item.selectedVariants[key] }}</strong></span
            >
            }
          </div>
        </div>
        <div class="item-actions">
          <button
            (click)="cartService.updateQuantity(item.id, item.quantity - 1)"
            class="quantity-btn"
            appRipple
          >
            -
          </button>
          <span class="quantity-value">{{ item.quantity }}</span>
          <button
            (click)="cartService.updateQuantity(item.id, item.quantity + 1)"
            class="quantity-btn"
            appRipple
          >
            +
          </button>
        </div>
      </div>
      }
    </div>

    <footer class="flyout-footer">
      <div class="subtotal-row">
        <span>Subtotal</span>
        <span>{{
          cartService.subTotal() | currency : "COP" : "symbol" : "1.0-0"
        }}</span>
      </div>
      <a routerLink="/cart" class="btn-material" (click)="closeCart()" appRipple
        >Ver Carrito y Pagar</a
      >
    </footer>

    } @else {
    <!-- ¡NUEVO! El estado del carrito vacío con TU Gato Interactivo -->
    <div class="empty-state" (click)="requestOrientationPermission()">
      <div class="cat-container">
        <!-- TU SVG - MODIFICADO CON IDs Y UN GRUPO <g> PARA LAS PUPILAS -->
        <img
          src="icon-cat.png"
          alt="Tu carrito está vacío"
          class="cat-animation"
        />
      </div>
      <p>Tu carrito está soñando...</p>
      <p class="subtitle">Añade algo para despertarlo.</p>
    </div>
    }
  </aside>
</div>
