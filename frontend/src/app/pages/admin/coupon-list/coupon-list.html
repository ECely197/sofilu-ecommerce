<header class="page-header">
  <h1>Cupones de Descuento</h1>
  <a routerLink="/admin/coupons/new" class="btn-material icon-btn" appRipple>
    <span class="material-symbols-outlined">add</span>
    <span class="text">Crear Cupón</span>
  </a>
</header>

<div class="search-bar-wrapper">
  <div class="search-field">
    <span class="material-symbols-outlined">search</span>
    <input
      type="text"
      [formControl]="searchControl"
      placeholder="Buscar cupón..."
      class="search-input"
    />
  </div>
</div>

<div class="table-container">
  @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando cupones...</p>
    </div>
  } @else if (coupons().length > 0) {
    <div class="coupon-list-grid" [@listAnimation]="coupons().length">
      <!-- CABECERA (SOLO DESKTOP) -->
      <div class="coupon-row header">
        <div class="col code-col">Código</div>
        <div class="col type-col">Descuento</div>
        <div class="col usage-col center">Usos</div>
        <div class="col date-col">Vence</div>
        <div class="col actions-col right">Acciones</div>
      </div>

      <!-- FILAS -->
      @for (coupon of coupons(); track coupon._id) {
        <div class="coupon-row item">
          <!-- Código (Estilo Cupón) -->
          <div class="col code-col" data-label="Código">
            <div class="coupon-badge">
              <span class="material-symbols-outlined icon">local_activity</span>
              <span class="code-text">{{ coupon.code }}</span>
            </div>
          </div>

          <!-- Valor del Descuento -->
          <div class="col type-col" data-label="Descuento">
            <div class="discount-value">
              @if (coupon.discountType === "Porcentaje") {
                <span class="percent">{{ coupon.value }}%</span> OFF
              } @else {
                <span class="amount">{{
                  coupon.value | currency: "COP" : "symbol" : "1.0-0"
                }}</span>
                OFF
              }
              <small class="target">en {{ coupon.appliesTo }}</small>
            </div>
          </div>

          <!-- Usos -->
          <div class="col usage-col center" data-label="Usos">
            <span
              class="usage-pill"
              [class.limit-reached]="
                coupon.usageLimit && coupon.timesUsed >= coupon.usageLimit
              "
            >
              {{ coupon.timesUsed }} / {{ coupon.usageLimit || "∞" }}
            </span>
          </div>

          <!-- Expiración -->
          <div class="col date-col" data-label="Vence">
            @if (coupon.expirationDate) {
              {{ coupon.expirationDate | date: "mediumDate" }}
            } @else {
              <span class="no-expire">Nunca</span>
            }
          </div>

          <!-- Acciones -->
          <div class="col actions-col right" data-label="Acciones">
            <div class="actions-wrapper">
              <a
                [routerLink]="['/admin/coupons/edit', coupon._id]"
                class="action-btn edit"
                title="Editar"
                appRipple
              >
                <span class="material-symbols-outlined">edit</span>
              </a>
              <button
                (click)="deleteCoupon(coupon._id)"
                class="action-btn delete"
                title="Eliminar"
                appRipple
              >
                <span class="material-symbols-outlined">delete</span>
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="empty-state">
      <span class="material-symbols-outlined icon">savings</span>
      <p>No tienes cupones activos.</p>
      <a routerLink="/admin/coupons/new" class="btn-link">Crear uno nuevo</a>
    </div>
  }
</div>
