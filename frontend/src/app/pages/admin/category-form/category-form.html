<header class="page-header">
  <div class="header-title">
    <a routerLink="/admin/categories" class="back-btn" appRipple>
      <span class="material-symbols-outlined">arrow_back</span>
    </a>
    <h1>{{ isEditMode() ? "Editar Categoría" : "Nueva Categoría" }}</h1>
  </div>
</header>

<form
  [formGroup]="categoryForm"
  (ngSubmit)="handleSubmit()"
  class="form-grid-layout"
>
  <!-- TARJETA PRINCIPAL -->
  <div class="card glass-panel">
    <h2 class="card-title">Información Básica</h2>

    <div class="material-field">
      <input
        id="name"
        type="text"
        formControlName="name"
        class="material-input"
        placeholder=" "
      />
      <label for="name" class="material-label">Nombre de la Categoría</label>
    </div>

    <div class="select-field">
      <label>Sección (Dónde aparecerá)</label>
      <div class="select-wrapper">
        <select formControlName="section">
          <option [ngValue]="null" disabled>Seleccionar...</option>
          @for (sec of sections(); track sec._id) {
            <option [value]="sec._id">{{ sec.name }}</option>
          }
        </select>
        <span class="material-symbols-outlined chevron">expand_more</span>
      </div>
    </div>
  </div>

  <!-- TARJETA IMAGEN -->
  <div class="card glass-panel">
    <h2 class="card-title">Imagen Representativa</h2>

    <!-- UPLOADER VISUAL -->
    <label class="image-uploader" for="file-input">
      @if (imagePreview()) {
        <img [src]="imagePreview()" class="image-preview" />
      } @else {
        <div class="uploader-placeholder">
          <span class="material-symbols-outlined">add_photo_alternate</span>
          <span>Subir Icono/Imagen</span>
        </div>
      }
      @if (isUploading()) {
        <div class="spinner-overlay"><div class="spinner"></div></div>
      }
      <input
        id="file-input"
        type="file"
        (change)="onFileSelected($event)"
        accept="image/*"
        hidden
      />
    </label>
  </div>

  <!-- ACCIONES FLOTANTES (Móvil) / ESTÁTICAS (Desktop) -->
  <div class="form-actions">
    <a routerLink="/admin/categories" class="btn-secondary">Cancelar</a>
    <button
      type="submit"
      [disabled]="categoryForm.invalid || isUploading()"
      class="btn-material"
    >
      {{ isUploading() ? "Guardando..." : "Guardar Categoría" }}
    </button>
  </div>
</form>
