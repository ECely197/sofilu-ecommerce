<!-- En: frontend/src/app/pages/admin/dashboard/dashboard.html -->
<header class="page-header">
  <h1>Dashboard</h1>
</header>

<!-- Primer bloque: Maneja el estado de carga -->
@if (isLoading()) {
<p>Cargando estadísticas...</p>
} @else {
<!-- Segundo bloque: Se muestra cuando la carga ha terminado -->
<!-- ¡CORRECCIÓN CLAVE! Anidamos otro @if y usamos el alias aquí -->
@if (summary(); as stats) {
<div class="dashboard-grid" @fadeInUp>
  <!-- Tarjetas de Estadísticas -->
  <div class="stat-card">
    <div class="card-icon revenue">
      <span class="material-symbols-outlined">payments</span>
    </div>
    <div class="card-content">
      <p class="stat-title">Ingresos Totales</p>
      <p class="stat-value">
        {{ stats.totalRevenue | currency : "COP" : "symbol" : "1.0-0" }}
      </p>
    </div>
  </div>
  <div class="stat-card">
    <div class="card-icon orders">
      <span class="material-symbols-outlined">shopping_bag</span>
    </div>
    <div class="card-content">
      <p class="stat-title">Pedidos Totales</p>
      <p class="stat-value">{{ stats.totalOrders }}</p>
    </div>
  </div>
  <div class="stat-card">
    <div class="card-icon products">
      <span class="material-symbols-outlined">inventory_2</span>
    </div>
    <div class="card-content">
      <p class="stat-title">Productos Totales</p>
      <p class="stat-value">{{ stats.totalProducts }}</p>
    </div>
  </div>

  <!-- ¡NUEVA TARJETA: VALOR DE INVENTARIO! -->
  <div class="stat-card inventory-card">
    <div class="card-icon inventory">
      <span class="material-symbols-outlined">inventory</span>
    </div>
    <div class="card-content">
      <p class="stat-title">Valor de Inventario (Venta)</p>
      <p class="stat-value">
        {{
          stats.inventoryValue.totalSaleValue
            | currency : "COP" : "symbol" : "1.0-0"
        }}
      </p>
      <p class="stat-subtitle">
        Costo:
        {{
          stats.inventoryValue.totalCostValue
            | currency : "COP" : "symbol" : "1.0-0"
        }}
      </p>
    </div>
  </div>

  <!-- ¡NUEVA TARJETA: CUPONES! -->
  <div class="card coupon-performance">
    <h2 class="card-title">Rendimiento de Cupones</h2>
    <div class="coupon-list">
      @for(coupon of stats.couponPerformance; track coupon._id){
      <div class="coupon-item">
        <span class="coupon-code">{{ coupon._id }}</span>
        <div class="coupon-stats">
          <span
            >Usos: <strong>{{ coupon.timesUsed }}</strong></span
          >
          <span
            >Descuento Total:
            <strong>{{
              coupon.totalDiscount | currency : "COP" : "symbol" : "1.0-0"
            }}</strong></span
          >
        </div>
      </div>
      } @empty {
      <p class="empty-message">Aún no se han usado cupones.</p>
      }
    </div>
  </div>

  <div class="performance-section" @fadeInUp>
    <app-vendor-performance></app-vendor-performance>
  </div>

  <!-- Tarjeta de Pedidos Recientes -->
  <div class="card recent-orders">
    <h2 class="card-title">Pedidos Recientes</h2>
    <div class="order-list">
      @for(order of stats.latestOrders; track order._id){
      <div class="order-item">
        <div class="order-info">
          <p class="customer-name">{{ order.customerInfo.name }}</p>
          <p class="order-id">#{{ order._id.slice(-6).toUpperCase() }}</p>
        </div>
        <div class="order-details">
          <span class="order-total">{{
            order.totalAmount | currency : "COP" : "symbol" : "1.0-0"
          }}</span>
          <a
            [routerLink]="['/admin/orders', order._id]"
            class="details-link"
            appRipple
            >Ver</a
          >
        </div>
      </div>
      } @empty {
      <p>No hay pedidos recientes.</p>
      }
    </div>
  </div>
</div>
} @else {
<!-- Se muestra si la carga terminó pero no hay datos de resumen -->
<p>No se pudieron cargar las estadísticas.</p>
} }
